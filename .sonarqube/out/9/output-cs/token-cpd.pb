ร
M/Users/pavel/project/NetMentoring/CatalogWebApi/AuthHelper/HasScopeHandler.cs
	namespace 	
CatalogWebApi
 
. 

AuthHelper "
;" #
public 
class 
HasScopeHandler 
:  
AuthorizationHandler 3
<3 4
HasScopeRequirement4 G
>G H
{		 
	protected 
override 
Task "
HandleRequirementAsync 2
(2 3'
AuthorizationHandlerContext3 N
contextO V
,V W
HasScopeRequirementX k
requirementl w
)w x
{ 
if 

( 
! 
context 
. 
User 
. 
HasClaim "
(" #
c# $
=>% '
c( )
.) *
Type* .
==/ 1
$str2 9
&&: <
c= >
.> ?
Issuer? E
==F H
requirementI T
.T U
IssuerU [
)[ \
)\ ]
return 
Task 
. 
CompletedTask %
;% &
var 
scopes 
= 
context 
. 
User !
.! "
	FindFirst" +
(+ ,
c, -
=>. 0
c1 2
.2 3
Type3 7
==8 :
$str; B
&&C E
cF G
.G H
IssuerH N
==O Q
requirementR ]
.] ^
Issuer^ d
)d e
.e f
Valuef k
.k l
Splitl q
(q r
$charr u
)u v
;v w
if 

( 
scopes 
. 
Any 
( 
s 
=> 
s 
==  
requirement! ,
., -
Scope- 2
)2 3
)3 4
context 
. 
Succeed 
( 
requirement '
)' (
;( )
return 
Task 
. 
CompletedTask !
;! "
} 
} 

Q/Users/pavel/project/NetMentoring/CatalogWebApi/AuthHelper/HasScopeRequirement.cs
	namespace 	
CatalogWebApi
 
. 

AuthHelper "
;" #
public 
class 
HasScopeRequirement  
:! "%
IAuthorizationRequirement# <
{		 
public 

string 
Issuer 
{ 
get 
; 
}  !
public 

string 
Scope 
{ 
get 
; 
}  
public 

HasScopeRequirement 
( 
string %
scope& +
,+ ,
string- 3
issuer4 :
): ;
{ 
Scope 
= 
scope 
?? 
throw 
new "!
ArgumentNullException# 8
(8 9
nameof9 ?
(? @
scope@ E
)E F
)F G
;G H
Issuer 
= 
issuer 
?? 
throw  
new! $!
ArgumentNullException% :
(: ;
nameof; A
(A B
issuerB H
)H I
)I J
;J K
} 
} 
K/Users/pavel/project/NetMentoring/CatalogWebApi/Configurators/AuthConfig.cs
	namespace 	
CatalogWebApi
 
. 
Configurators %
;% &
public 
static 
class 

AuthConfig 
{ 
public 

static 
Action 
< 
JwtBearerOptions )
>) *
ConfigureJwtBearer+ =
(= >!
WebApplicationBuilder> S
builderT [
)[ \
{ 
return 
options 
=> 
{ 	
options 
. 
	Authority 
= 
$"  "
$str" *
{* +
builder+ 2
.2 3
Configuration3 @
[@ A
$strA O
]O P
}P Q
$strQ R
"R S
;S T
options 
. 
Audience 
= 
builder &
.& '
Configuration' 4
[4 5
$str5 E
]E F
;F G
options 
. %
TokenValidationParameters -
=. /
new0 3%
TokenValidationParameters4 M
{ 
NameClaimType 
= 

ClaimTypes  *
.* +
NameIdentifier+ 9
} 
; 
} 	
;	 

} 
public%% 

static%% 
Action%% 
<%%  
AuthorizationOptions%% -
>%%- ."
ConfigureAuthorization%%/ E
(%%E F!
WebApplicationBuilder%%F [
builder%%\ c
)%%c d
{&& 
return'' 
options'' 
=>'' 
{(( 	
var)) 
scopes)) 
=)) 
new)) 
[)) 
])) 
{))  
$str))! 0
,))0 1
$str))2 C
,))C D
$str))E V
,))V W
$str))X i
}))j k
;))k l
foreach++ 
(++ 
var++ 
scope++ 
in++ !
scopes++" (
)++( )
{,, 
var-- 
requirement-- 
=--  !
new--" %
HasScopeRequirement--& 9
(--9 :
scope--: ?
,--? @
$"--A C
$str--C K
{--K L
builder--L S
.--S T
Configuration--T a
[--a b
$str--b p
]--p q
}--q r
$str--r s
"--s t
)--t u
;--u v
options.. 
... 
	AddPolicy.. !
(..! "
scope.." '
,..' (
policy..) /
=>..0 2
policy..3 9
...9 :
Requirements..: F
...F G
Add..G J
(..J K
requirement..K V
)..V W
)..W X
;..X Y
}// 
}11 	
;11	 

}33 
}44 ั,
X/Users/pavel/project/NetMentoring/CatalogWebApi/Configurators/ConfigureSwaggerOptions.cs
	namespace 	
CatalogWebApi
 
. 
Configurators %
;% &
public 
class #
ConfigureSwaggerOptions $
:% &
IConfigureOptions' 8
<8 9
SwaggerGenOptions9 J
>J K
{ 
private 	
readonly
 *
IApiVersionDescriptionProvider 1
	_provider2 ;
;; <
public #
ConfigureSwaggerOptions	  
(  !*
IApiVersionDescriptionProvider! ?
provider@ H
)H I
=>J L
	_providerM V
=W X
providerY a
;a b
public 
void	 
	Configure 
( 
SwaggerGenOptions )
options* 1
)1 2
{ 
foreach 
( 
var 
description 
in 
	_provider  )
.) *"
ApiVersionDescriptions* @
)@ A
{ 
options 
. 

SwaggerDoc 
( 
description $
.$ %
	GroupName% .
,. /#
CreateInfoForApiVersion0 G
(G H
descriptionH S
)S T
)T U
;U V
}   
}!! 
private## 	
static##
 
OpenApiInfo## #
CreateInfoForApiVersion## 4
(##4 5!
ApiVersionDescription##5 J
description##K V
)##V W
{$$ 
var%% 
text%% 
=%% 
new%% 
StringBuilder%%  
(%%  !
$str%%! h
)%%h i
;%%i j
var&& 
info&& 
=&& 
new&& 
OpenApiInfo&& 
(&& 
)&&  
{'' 
Title(( 
=(( 
$str((  
,((  !
Version)) 
=)) 
description)) 
.)) 

ApiVersion)) &
.))& '
ToString))' /
())/ 0
)))0 1
,))1 2
Contact** 
=** 
new** 
OpenApiContact** "
(**" #
)**# $
{**% &
Name**' +
=**, -
$str**. ?
,**? @
Email**A F
=**G H
$str**I X
}**Y Z
,**Z [
License++ 
=++ 
new++ 
OpenApiLicense++ "
(++" #
)++# $
{++% &
Name++' +
=++, -
$str++. 3
,++3 4
Url++5 8
=++9 :
new++; >
Uri++? B
(++B C
$str++C h
)++h i
}++j k
},, 
;,, 
if.. 
(.. 
description.. 
... 
IsDeprecated..  
)..  !
{// 
text00 

.00
 
Append00 
(00 
$str00 :
)00: ;
;00; <
}11 
if33 
(33 
description33 
.33 
SunsetPolicy33  
is33! #
{33$ %
}33& '
policy33( .
)33. /
{44 
if55 
(55	 

policy55
 
.55 
Date55 
is55 
{55 
}55 
when55 !
)55! "
{66 
text77 
.77 
Append77 
(77 
$str77 1
)771 2
.88 
Append88 
(88 
when88 
.88 
Date88 
.88 
ToShortDateString88 /
(88/ 0
)880 1
)881 2
.99 
Append99 
(99 
$char99 
)99 
;99 
}:: 
if<< 
(<<	 

policy<<
 
.<< 
HasLinks<< 
)<< 
{== 
text>> 
.>> 

AppendLine>> 
(>> 
)>> 
;>> 
for@@ 
(@@ 
var@@ 
i@@ 
=@@ 
$num@@ 
;@@ 
i@@ 
<@@ 
policy@@ "
.@@" #
Links@@# (
.@@( )
Count@@) .
;@@. /
i@@0 1
++@@1 3
)@@3 4
{AA 	
varBB
 
linkBB 
=BB 
policyBB 
.BB 
LinksBB !
[BB! "
iBB" #
]BB# $
;BB$ %
ifDD
 
(DD 
linkDD 
.DD 
TypeDD 
==DD 
$strDD &
)DD& '
{EE
 
textFF 
.FF 

AppendLineFF 
(FF 
)FF 
;FF 
ifHH 
(HH 
linkHH 
.HH 
TitleHH 
.HH 
HasValueHH #
)HH# $
{II 
textJJ 
.JJ 
AppendJJ 
(JJ 
linkJJ 
.JJ 
TitleJJ $
.JJ$ %
ValueJJ% *
)JJ* +
.JJ+ ,
AppendJJ, 2
(JJ2 3
$strJJ3 7
)JJ7 8
;JJ8 9
}KK 
textMM 
.MM 
AppendMM 
(MM 
linkMM 
.MM 

LinkTargetMM '
.MM' (
OriginalStringMM( 6
)MM6 7
;MM7 8
}NN
 
}OO 	
}PP 
}QQ 
infoSS 
.SS 	
DescriptionSS	 
=SS 
textSS 
.SS 
ToStringSS $
(SS$ %
)SS% &
;SS& '
returnUU 

infoUU 
;UU 
}VV 
}WW 
O/Users/pavel/project/NetMentoring/CatalogWebApi/Configurators/EventBusConfig.cs
	namespace 	
CatalogWebApi
 
. 
Configurators %
;% &
public 
static 
class 
EventBusConfig "
{		 
public 

static 
IEventBusRabbitMq #%
ConfigureEventBusRabbitMq$ =
(= >!
WebApplicationBuilder> S
builderT [
)[ \
{ 
var 
rabbitMqHost 
= 
builder "
." #
Configuration# 0
.0 1

GetSection1 ;
(; <
$str< J
)J K
.K L
ValueL Q
;Q R
var 
rabbitMqPort 
= 
int 
. 
Parse $
($ %
builder% ,
., -
Configuration- :
.: ;

GetSection; E
(E F
$strF T
)T U
.U V
ValueV [
??\ ^
$str_ e
)e f
;f g
var 
rabbitMqUser 
= 
builder "
." #
Configuration# 0
.0 1

GetSection1 ;
(; <
$str< J
)J K
.K L
ValueL Q
;Q R
var 
rabbitMqPassword 
= 
builder &
.& '
Configuration' 4
.4 5

GetSection5 ?
(? @
$str@ R
)R S
.S T
ValueT Y
;Y Z
var 
rabbitMqQueue 
= 
builder #
.# $
Configuration$ 1
.1 2

GetSection2 <
(< =
$str= L
)L M
.M N
ValueN S
;S T
return 
new 
EventBusRabbitMq #
(# $
rabbitMqQueue 
?? 
throw "
new# &%
InvalidOperationException' @
(@ A
)A B
,B C
rabbitMqHost 
?? 
throw !
new" %%
InvalidOperationException& ?
(? @
)@ A
,A B
rabbitMqPort 
, 
rabbitMqUser 
?? 
throw !
new" %%
InvalidOperationException& ?
(? @
)@ A
,A B
rabbitMqPassword 
?? 
throw  %
new& )%
InvalidOperationException* C
(C D
)D E
)E F
;F G
} 
}   ๋+
N/Users/pavel/project/NetMentoring/CatalogWebApi/Configurators/SwaggerConfig.cs
	namespace 	
CatalogWebApi
 
. 
Configurators %
;% &
public 
static 
class 
SwaggerConfig !
{ 
public 

static 
void "
SetupSwaggerGenOptions -
(- .
SwaggerGenOptions. ?
options@ G
)G H
{ 
options 
. 
OperationFilter 
<   
SwaggerDefaultValues  4
>4 5
(5 6
)6 7
;7 8
options 
. !
AddSecurityDefinition %
(% &
$str& .
,. /
new0 3!
OpenApiSecurityScheme4 I
{ 	
Description 
= 
$str <
,< =
Name 
= 
$str "
," #
In 
= 
ParameterLocation "
." #
Header# )
,) *
Type 
= 
SecuritySchemeType %
.% &
ApiKey& ,
,, -
Scheme   
=   
$str   
}!! 	
)!!	 

;!!
 
options"" 
."" "
AddSecurityRequirement"" &
(""& '
new""' *&
OpenApiSecurityRequirement""+ E
(""E F
)""F G
{## 	
{$$ 
new%% !
OpenApiSecurityScheme%% )
{&& 
	Reference'' 
='' 
new''  #
OpenApiReference''$ 4
{(( 
Type)) 
=)) 
ReferenceType)) ,
.)), -
SecurityScheme))- ;
,)); <
Id** 
=** 
$str** %
}++ 
,++ 
Scheme,, 
=,, 
$str,, %
,,,% &
Name-- 
=-- 
$str-- #
,--# $
In.. 
=.. 
ParameterLocation.. *
...* +
Header..+ 1
,..1 2
}00 
,00 
new11 
List11 
<11 
string11 
>11  
(11  !
)11! "
}22 
}33 	
)33	 

;33
 
var55 
fileName55 
=55 
typeof55 
(55 
Program55 %
)55% &
.55& '
Assembly55' /
.55/ 0
GetName550 7
(557 8
)558 9
.559 :
Name55: >
+55? @
$str55A G
;55G H
var66 
filePath66 
=66 
Path66 
.66 
Combine66 #
(66# $

AppContext66$ .
.66. /
BaseDirectory66/ <
,66< =
fileName66> F
)66F G
;66G H
options99 
.99 
IncludeXmlComments99 "
(99" #
filePath99# +
)99+ ,
;99, -
}:: 
public@@ 

static@@ 
void@@ #
SetupApiExplorerOptions@@ .
(@@. /
ApiExplorerOptions@@/ A
options@@B I
)@@I J
{AA 
optionsDD 
.DD 
GroupNameFormatDD 
=DD  !
$strDD" *
;DD* +
optionsHH 
.HH %
SubstituteApiVersionInUrlHH )
=HH* +
trueHH, 0
;HH0 1
}II 
publicOO 

staticOO 
voidOO %
SetupApiVersioningOptionsOO 0
(OO0 1 
ApiVersioningOptionsOO1 E
optionsOOF M
)OOM N
{PP 
optionsSS 
.SS 
ReportApiVersionsSS !
=SS" #
trueSS$ (
;SS( )
optionsUU 
.UU 
PoliciesUU 
.UU 
SunsetUU 
(UU  
$numUU  #
)UU# $
.VV 
	EffectiveVV 
(VV 
DateTimeOffsetVV %
.VV% &
NowVV& )
.VV) *
AddDaysVV* 1
(VV1 2
$numVV2 4
)VV4 5
)VV5 6
.WW 
LinkWW 
(WW 
$strWW 
)WW  
.XX 
TitleXX 
(XX 
$strXX &
)XX& '
.YY 
TypeYY 
(YY 
$strYY 
)YY 
;YY 
}ZZ 
publicaa 

staticaa 
voidaa !
SetupSwaggerUiOptionsaa ,
(aa, -
SwaggerUIOptionsaa- =
optionsaa> E
,aaE F
WebApplicationaaG U
appaaV Y
)aaY Z
{bb 
varcc 
descriptionscc 
=cc 
appcc 
.cc 
DescribeApiVersionscc 2
(cc2 3
)cc3 4
;cc4 5
foreachff 
(ff 
varff 
descriptionff  
inff! #
descriptionsff$ 0
)ff0 1
{gg 	
varhh 
urlhh 
=hh 
$"hh 
$strhh !
{hh! "
descriptionhh" -
.hh- .
	GroupNamehh. 7
}hh7 8
$strhh8 E
"hhE F
;hhF G
varii 
nameii 
=ii 
descriptionii "
.ii" #
	GroupNameii# ,
.ii, -
ToUpperInvariantii- =
(ii= >
)ii> ?
;ii? @
optionsjj 
.jj 
SwaggerEndpointjj #
(jj# $
urljj$ '
,jj' (
namejj) -
)jj- .
;jj. /
}kk 	
}ll 
}mm ใ$
U/Users/pavel/project/NetMentoring/CatalogWebApi/Configurators/SwaggerDefaultValues.cs
	namespace 	
CatalogWebApi
 
. 
Configurators %
;% &
public 
class  
SwaggerDefaultValues !
:" #
IOperationFilter$ 4
{ 
public 
void	 
Apply 
( 
OpenApiOperation $
	operation% .
,. /"
OperationFilterContext0 F
contextG N
)N O
{ 
var 
apiDescription 
= 
context  
.  !
ApiDescription! /
;/ 0
	operation 
. 

Deprecated 
|= 
apiDescription *
.* +
IsDeprecated+ 7
(7 8
)8 9
;9 :
foreach 
( 
var 
responseType 
in  
context! (
.( )
ApiDescription) 7
.7 8"
SupportedResponseTypes8 N
)N O
{ 
var 	
responseKey
 
= 
responseType $
.$ %
IsDefaultResponse% 6
?7 8
$str9 B
:C D
responseTypeE Q
.Q R

StatusCodeR \
.\ ]
ToString] e
(e f
)f g
;g h
var 	
response
 
= 
	operation 
. 
	Responses (
[( )
responseKey) 4
]4 5
;5 6
foreach 
( 
var 
contentType 
in !
response" *
.* +
Content+ 2
.2 3
Keys3 7
)7 8
{ 
if 

( 
responseType 
. 
ApiResponseFormats +
.+ ,
All, /
(/ 0
x0 1
=>2 4
x5 6
.6 7
	MediaType7 @
!=A C
contentTypeD O
)O P
)P Q
{   	
response!!
 
.!! 
Content!! 
.!! 
Remove!! !
(!!! "
contentType!!" -
)!!- .
;!!. /
}"" 	
}## 
}$$ 
if&& 
(&& 
	operation&& 
.&& 

Parameters&& 
==&& 
null&&  $
)&&$ %
{'' 
return(( 
;(( 
})) 
foreach-- 
(-- 
var-- 
	parameter-- 
in-- 
	operation-- '
.--' (

Parameters--( 2
)--2 3
{.. 
var// 	
description//
 
=// 
apiDescription// &
.//& '!
ParameterDescriptions//' <
.//< =
First//= B
(//B C
p//C D
=>//E G
p//H I
.//I J
Name//J N
==//O Q
	parameter//R [
.//[ \
Name//\ `
)//` a
;//a b
	parameter11 
.11 
Description11 
??=11 
description11  +
.11+ ,
ModelMetadata11, 9
?119 :
.11: ;
Description11; F
;11F G
if33 
(33	 

	parameter33
 
.33 
Schema33 
.33 
Default33 "
==33# %
null33& *
&&33+ -
description44 
.44 
DefaultValue44 #
!=44$ &
null44' +
&&44, .
description55 
.55 
DefaultValue55 #
is55$ &
not55' *
DBNull55+ 1
&&552 4
description66 
.66 
ModelMetadata66 $
is66% '
{66( )
}66* +
modelMetadata66, 9
)669 :
{77 
var99 
json99 
=99 
JsonSerializer99 !
.99! "
	Serialize99" +
(99+ ,
description99, 7
.997 8
DefaultValue998 D
,99D E
modelMetadata99F S
.99S T
	ModelType99T ]
)99] ^
;99^ _
	parameter:: 
.:: 
Schema:: 
.:: 
Default::  
=::! "
OpenApiAnyFactory::# 4
.::4 5
CreateFromJson::5 C
(::C D
json::D H
)::H I
;::I J
};; 
	parameter== 
.== 
Required== 
|=== 
description== '
.==' (

IsRequired==( 2
;==2 3
}>> 
}?? 
}@@ ขอ
S/Users/pavel/project/NetMentoring/CatalogWebApi/Controllers/V1/CatalogController.cs
	namespace 	
CatalogWebApi
 
. 
Controllers #
.# $
V1$ &
;& '
[ 

ApiVersion 
( 
$str 
) 
] 
[ 
ApiController 
] 
[ 
Route 
( 
$str /
)/ 0
]0 1
public 
class 
CatalogController 
:  
ControllerBase! /
{ 
private 
readonly 
ILogger 
< 
CatalogController .
>. /
_logger0 7
;7 8
private 
readonly 
ICategoryService %
_categoryService& 6
;6 7
private 
readonly 
IProductItemService (
_productItemService) <
;< =
public 

CatalogController 
( 
ILogger $
<$ %
CatalogController% 6
>6 7
logger8 >
,> ?
ICategoryService 
categoryService (
,( )
IProductItemService 
productItemService .
). /
{ 
_logger 
= 
logger 
; 
_categoryService   
=   
categoryService   *
;  * +
_productItemService!! 
=!! 
productItemService!! 0
;!!0 1
}"" 
[** 
MapToApiVersion** 
(** 
$str** 
)** 
]** 
[++ 
HttpGet++ 
(++ 
$str++ 
)++ 
]++ 
[,, 
	Authorize,, 
(,, 
$str,, 
),, 
],,  
public-- 

async-- 
Task-- 
<-- 
IActionResult-- #
>--# $
GetCategories--% 2
(--2 3
)--3 4
{.. 
try// 
{00 	
var11 

categories11 
=11 
await11 "
_categoryService11# 3
.113 4
GetAllAsync114 ?
(11? @
)11@ A
;11A B
var33 
response33 
=33 
new33 
HalResponse33 *
{44 
Links55 
=55 
new55 
List55  
<55  !
Link55! %
>55% &
{66 
new77 
(77 
)77 
{77 
Rel77 
=77  !
$str77" (
,77( )
Href77* .
=77/ 0
$str771 F
}77G H
,77H I
new88 
(88 
)88 
{88 
Rel88 
=88  !
$str88" '
,88' (
Href88) -
=88. /
$str880 E
,88E F
Method88G M
=88N O
$str88P V
}88W X
}99 
,99 
Embedded:: 
=:: 
new:: 

Dictionary:: )
<::) *
string::* 0
,::0 1
object::2 8
>::8 9
{;; 
[<< 
$str<< !
]<<! "
=<<# $

categories<<% /
.<</ 0
Select<<0 6
(<<6 7
c<<7 8
=><<9 ;
new<<< ?
HalResponse<<@ K
{== 
Links>> 
=>> 
new>>  #
List>>$ (
<>>( )
Link>>) -
>>>- .
{?? 
new@@ 
(@@  
)@@  !
{@@" #
Rel@@$ '
=@@( )
$str@@* 0
,@@0 1
Href@@2 6
=@@7 8
$"@@9 ;
$str@@; O
{@@O P
c@@P Q
.@@Q R
Id@@R T
}@@T U
"@@U V
}@@W X
,@@X Y
newAA 
(AA  
)AA  !
{AA" #
RelAA$ '
=AA( )
$strAA* 2
,AA2 3
HrefAA4 8
=AA9 :
$"AA; =
$strAA= Q
{AAQ R
cAAR S
.AAS T
IdAAT V
}AAV W
"AAW X
,AAX Y
MethodAAZ `
=AAa b
$strAAc h
}AAi j
,AAj k
newBB 
(BB  
)BB  !
{BB" #
RelBB$ '
=BB( )
$strBB* 2
,BB2 3
HrefBB4 8
=BB9 :
$"BB; =
$strBB= Q
{BBQ R
cBBR S
.BBS T
IdBBT V
}BBV W
"BBW X
,BBX Y
MethodBBZ `
=BBa b
$strBBc k
}BBl m
}CC 
,CC 
DataDD 
=DD 
cDD  
}EE 
)EE 
}FF 
}GG 
;GG 
_loggerHH 
.HH 

LogWarningHH 
(HH 
$strHH @
)HH@ A
;HHA B
_loggerII 
.II 
LogErrorII 
(II 
$strII C
)IIC D
;IID E
returnJJ 
OkJJ 
(JJ 
responseJJ 
)JJ 
;JJ  
}KK 	
catchLL 
(LL 
	ExceptionLL 
eLL 
)LL 
{MM 	
returnNN 
NotFoundNN 
(NN 
eNN 
.NN 
MessageNN %
)NN% &
;NN& '
}OO 	
}PP 
[YY 
HttpPostYY 
(YY 
$strYY 
)YY 
]YY 
[ZZ 
	AuthorizeZZ 
(ZZ 
$strZZ  
)ZZ  !
]ZZ! "
public[[ 

async[[ 
Task[[ 
<[[ 
IActionResult[[ #
>[[# $
AddCategory[[% 0
([[0 1
Category[[1 9
category[[: B
)[[B C
{\\ 
try]] 
{^^ 	
await__ 
_categoryService__ "
.__" #
AddAsync__# +
(__+ ,
category__, 4
)__4 5
;__5 6
return`` 
CreatedAtAction`` "
(``" #
nameof``# )
(``) *
GetCategoryById``* 9
)``9 :
,``: ;
new``< ?
{``@ A
id``B D
=``E F
category``G O
.``O P
Id``P R
}``S T
,``T U
category``V ^
)``^ _
;``_ `
}aa 	
catchbb 
(bb 
	Exceptionbb 
ebb 
)bb 
{cc 	
returndd 

BadRequestdd 
(dd 
edd 
.dd  
Messagedd  '
)dd' (
;dd( )
}ee 	
}ff 
[oo 
HttpGetoo 
(oo 
$stroo 
)oo 
]oo  
[pp 
	Authorizepp 
(pp 
$strpp 
)pp 
]pp  
publicqq 

asyncqq 
Taskqq 
<qq 
IActionResultqq #
>qq# $
GetCategoryByIdqq% 4
(qq4 5
intqq5 8
idqq9 ;
)qq; <
{rr 
tryss 
{tt 	
varuu 
categoryuu 
=uu 
awaituu  
_categoryServiceuu! 1
.uu1 2
GetByIdAsyncuu2 >
(uu> ?
iduu? A
)uuA B
;uuB C
ifww 
(ww 
categoryww 
==ww 
nullww  
)ww  !
{xx 
returnyy 
NotFoundyy 
(yy  
)yy  !
;yy! "
}zz 
var|| 
response|| 
=|| 
new|| 
HalResponse|| *
{}} 
Links~~ 
=~~ 
new~~ 
List~~  
<~~  !
Link~~! %
>~~% &
{ 
new
 
(
 
)
 
{
 
Rel
 
=
  !
$str
" (
,
( )
Href
* .
=
/ 0
$"
1 3
$str
3 G
{
G H
id
H J
}
J K
"
K L
}
M N
,
N O
new
 
(
 
)
 
{
 
Rel
 
=
  !
$str
" *
,
* +
Href
, 0
=
1 2
$"
3 5
$str
5 I
{
I J
id
J L
}
L M
"
M N
,
N O
Method
P V
=
W X
$str
Y ^
}
_ `
,
` a
new
 
(
 
)
 
{
 
Rel
 
=
  !
$str
" *
,
* +
Href
, 0
=
1 2
$"
3 5
$str
5 I
{
I J
id
J L
}
L M
"
M N
,
N O
Method
P V
=
W X
$str
Y a
}
b c
}
 
,
 
Data
 
=
 
category
 
}
 
;
 
return
 
Ok
 
(
 
response
 
)
 
;
  
}
 	
catch
 
(
 
	Exception
 
e
 
)
 
{
 	
return
 
NotFound
 
(
 
e
 
.
 
Message
 %
)
% &
;
& '
}
 	
}
 
[
 
HttpPut
 
(
 
$str
 
)
 
]
 
[
 
	Authorize
 
(
 
$str
  
)
  !
]
! "
public
 

async
 
Task
 
<
 
IActionResult
 #
>
# $
UpdateCategory
% 3
(
3 4
Category
4 <
category
= E
)
E F
{
 
try
 
{
 	
if
 
(
 
category
 
==
 
null
  
)
  !
{
 
return
 

BadRequest
 !
(
! "
)
" #
;
# $
}
 
await
กก 
_categoryService
กก "
.
กก" #
UpdateAsync
กก# .
(
กก. /
category
กก/ 7
)
กก7 8
;
กก8 9
return
ขข 
Ok
ขข 
(
ขข 
$"
ขข 
$str
ขข )
{
ขข) *
category
ขข* 2
.
ขข2 3
Id
ขข3 5
}
ขข5 6
$str
ขข6 >
"
ขข> ?
)
ขข? @
;
ขข@ A
}
ฃฃ 	
catch
คค 
(
คค 
	Exception
คค 
e
คค 
)
คค 
{
ฅฅ 	
return
ฆฆ 

BadRequest
ฆฆ 
(
ฆฆ 
e
ฆฆ 
.
ฆฆ  
Message
ฆฆ  '
)
ฆฆ' (
;
ฆฆ( )
}
งง 	
}
จจ 
[
ฑฑ 

HttpDelete
ฑฑ 
(
ฑฑ 
$str
ฑฑ !
)
ฑฑ! "
]
ฑฑ" #
[
ฒฒ 
	Authorize
ฒฒ 
(
ฒฒ 
$str
ฒฒ  
)
ฒฒ  !
]
ฒฒ! "
public
ณณ 

async
ณณ 
Task
ณณ 
<
ณณ 
IActionResult
ณณ #
>
ณณ# $
DeleteCategory
ณณ% 3
(
ณณ3 4
int
ณณ4 7
id
ณณ8 :
)
ณณ: ;
{
ดด 
try
ตต 
{
ถถ 	
await
ทท 
_categoryService
ทท "
.
ทท" #
DeleteAsync
ทท# .
(
ทท. /
id
ทท/ 1
)
ทท1 2
;
ทท2 3
return
ธธ 
Ok
ธธ 
(
ธธ 
$"
ธธ 
$str
ธธ )
{
ธธ) *
id
ธธ* ,
}
ธธ, -
$str
ธธ- H
"
ธธH I
)
ธธI J
;
ธธJ K
}
นน 	
catch
บบ 
(
บบ 
	Exception
บบ 
e
บบ 
)
บบ 
{
ปป 	
return
ผผ 
NotFound
ผผ 
(
ผผ 
e
ผผ 
.
ผผ 
Message
ผผ %
)
ผผ% &
;
ผผ& '
}
ฝฝ 	
}
พพ 
[
ศศ 
HttpGet
ศศ 
(
ศศ 
$str
ศศ 
)
ศศ 
]
ศศ 
public
ษษ 

async
ษษ 
Task
ษษ 
<
ษษ 
IActionResult
ษษ #
>
ษษ# $
GetProductItems
ษษ% 4
(
ษษ4 5
int
ษษ5 8

categoryId
ษษ9 C
,
ษษC D
int
ษษE H
page
ษษI M
=
ษษN O
$num
ษษP Q
)
ษษQ R
{
สส 
try
หห 
{
ฬฬ 	
var
ออ 
items
ออ 
=
ออ 
await
ออ !
_productItemService
ออ 1
.
ออ1 2
GetAllAsync
ออ2 =
(
ออ= >
page
ออ> B
)
ออB C
;
ออC D
var
ฯฯ 
productItems
ฯฯ 
=
ฯฯ 
items
ฯฯ $
.
ฯฯ$ %
ToList
ฯฯ% +
(
ฯฯ+ ,
)
ฯฯ, -
;
ฯฯ- .
if
ะะ 
(
ะะ 
!
ะะ 
productItems
ะะ 
.
ะะ 
Any
ะะ !
(
ะะ! "
)
ะะ" #
)
ะะ# $
{
ัั 
return
าา 
NotFound
าา 
(
าา  
)
าา  !
;
าา! "
}
ำำ 
var
ีี 
response
ีี 
=
ีี 
new
ีี 
HalResponse
ีี *
{
ึึ 
Links
ืื 
=
ืื 
new
ืื 
List
ืื  
<
ืื  !
Link
ืื! %
>
ืื% &
{
ุุ 
new
ูู 
(
ูู 
)
ูู 
{
ูู 
Rel
ูู 
=
ูู  !
$str
ูู" (
,
ูู( )
Href
ูู* .
=
ูู/ 0
$"
ูู1 3
$str
ูู3 M
{
ููM N

categoryId
ููN X
}
ููX Y
$str
ููY _
{
ูู_ `
page
ูู` d
}
ููd e
"
ููe f
}
ููg h
,
ููh i
new
ฺฺ 
(
ฺฺ 
)
ฺฺ 
{
ฺฺ 
Rel
ฺฺ 
=
ฺฺ  !
$str
ฺฺ" '
,
ฺฺ' (
Href
ฺฺ) -
=
ฺฺ. /
$str
ฺฺ0 @
,
ฺฺ@ A
Method
ฺฺB H
=
ฺฺI J
$str
ฺฺK Q
}
ฺฺR S
}
 
,
 
Embedded
 
=
 
new
 

Dictionary
 )
<
) *
string
* 0
,
0 1
object
2 8
>
8 9
{
 
[
 
$str
 
]
 
=
 
productItems
  ,
.
, -
Select
- 3
(
3 4
i
4 5
=>
6 8
new
9 <
HalResponse
= H
{
฿฿ 
Links
เเ 
=
เเ 
new
เเ  #
List
เเ$ (
<
เเ( )
Link
เเ) -
>
เเ- .
{
แแ 
new
โโ 
(
โโ  
)
โโ  !
{
โโ" #
Rel
โโ$ '
=
โโ( )
$str
โโ* 0
,
โโ0 1
Href
โโ2 6
=
โโ7 8
$"
โโ9 ;
$str
โโ; J
{
โโJ K
i
โโK L
.
โโL M
Id
โโM O
}
โโO P
"
โโP Q
}
โโR S
,
โโS T
new
ใใ 
(
ใใ  
)
ใใ  !
{
ใใ" #
Rel
ใใ$ '
=
ใใ( )
$str
ใใ* 2
,
ใใ2 3
Href
ใใ4 8
=
ใใ9 :
$"
ใใ; =
$str
ใใ= L
{
ใใL M
i
ใใM N
.
ใใN O
Id
ใใO Q
}
ใใQ R
"
ใใR S
,
ใใS T
Method
ใใU [
=
ใใ\ ]
$str
ใใ^ c
}
ใใd e
,
ใใe f
new
ไไ 
(
ไไ  
)
ไไ  !
{
ไไ" #
Rel
ไไ$ '
=
ไไ( )
$str
ไไ* 2
,
ไไ2 3
Href
ไไ4 8
=
ไไ9 :
$"
ไไ; =
$str
ไไ= L
{
ไไL M
i
ไไM N
.
ไไN O
Id
ไไO Q
}
ไไQ R
"
ไไR S
,
ไไS T
Method
ไไU [
=
ไไ\ ]
$str
ไไ^ f
}
ไไg h
}
ๅๅ 
,
ๅๅ 
Data
ๆๆ 
=
ๆๆ 
i
ๆๆ  
}
็็ 
)
็็ 
}
่่ 
}
้้ 
;
้้ 
return
๊๊ 
Ok
๊๊ 
(
๊๊ 
response
๊๊ 
)
๊๊ 
;
๊๊  
}
๋๋ 	
catch
์์ 
(
์์ 
	Exception
์์ 
e
์์ 
)
์์ 
{
ํํ 	
return
๎๎ 

BadRequest
๎๎ 
(
๎๎ 
e
๎๎ 
.
๎๎  
Message
๎๎  '
)
๎๎' (
;
๎๎( )
}
๏๏ 	
}
๐๐ 
[
๙๙ 
HttpPost
๙๙ 
(
๙๙ 
$str
๙๙ 
)
๙๙ 
]
๙๙ 
public
๚๚ 

async
๚๚ 
Task
๚๚ 
<
๚๚ 
IActionResult
๚๚ #
>
๚๚# $
AddProductItem
๚๚% 3
(
๚๚3 4
ProductItem
๚๚4 ?
item
๚๚@ D
)
๚๚D E
{
๛๛ 
if
 

(
 
item
 
==
 
null
 
)
 
{
 	
return
 

BadRequest
 
(
 
)
 
;
  
}
 	
try
 
{
 	
await
 !
_productItemService
 %
.
% &
AddAsync
& .
(
. /
item
/ 3
)
3 4
;
4 5
return
 
CreatedAtAction
 "
(
" #
nameof
# )
(
) * 
GetProductItemById
* <
)
< =
,
= >
new
? B
{
C D
id
E G
=
H I
item
J N
.
N O
Id
O Q
}
R S
,
S T
item
U Y
)
Y Z
;
Z [
}
 	
catch
 
(
 
	Exception
 
e
 
)
 
{
 	
return
 

BadRequest
 
(
 
e
 
.
  
Message
  '
)
' (
;
( )
}
 	
}
 
[
 
HttpGet
 
(
 
$str
 
)
 
]
 
public
 

async
 
Task
 
<
 
IActionResult
 #
>
# $ 
GetProductItemById
% 7
(
7 8
int
8 ;
id
< >
)
> ?
{
 
try
 
{
 	
var
 
item
 
=
 
await
 !
_productItemService
 0
.
0 1
GetByIdAsync
1 =
(
= >
id
> @
)
@ A
;
A B
if
 
(
 
item
 
==
 
null
 
)
 
{
 
return
 
NotFound
 
(
  
)
  !
;
! "
}
 
var
 
response
 
=
 
new
 
HalResponse
 *
{
 
Links
กก 
=
กก 
new
กก 
List
กก  
<
กก  !
Link
กก! %
>
กก% &
{
ขข 
new
ฃฃ 
(
ฃฃ 
)
ฃฃ 
{
ฃฃ 
Rel
ฃฃ 
=
ฃฃ  !
$str
ฃฃ" (
,
ฃฃ( )
Href
ฃฃ* .
=
ฃฃ/ 0
$"
ฃฃ1 3
$str
ฃฃ3 B
{
ฃฃB C
id
ฃฃC E
}
ฃฃE F
"
ฃฃF G
}
ฃฃH I
,
ฃฃI J
new
คค 
(
คค 
)
คค 
{
คค 
Rel
คค 
=
คค  !
$str
คค" *
,
คค* +
Href
คค, 0
=
คค1 2
$"
คค3 5
$str
คค5 D
{
คคD E
id
คคE G
}
คคG H
"
คคH I
,
คคI J
Method
คคK Q
=
คคR S
$str
คคT Y
}
คคZ [
,
คค[ \
new
ฅฅ 
(
ฅฅ 
)
ฅฅ 
{
ฅฅ 
Rel
ฅฅ 
=
ฅฅ  !
$str
ฅฅ" *
,
ฅฅ* +
Href
ฅฅ, 0
=
ฅฅ1 2
$"
ฅฅ3 5
$str
ฅฅ5 D
{
ฅฅD E
id
ฅฅE G
}
ฅฅG H
"
ฅฅH I
,
ฅฅI J
Method
ฅฅK Q
=
ฅฅR S
$str
ฅฅT \
}
ฅฅ] ^
}
ฆฆ 
,
ฆฆ 
Data
งง 
=
งง 
item
งง 
}
จจ 
;
จจ 
return
ชช 
Ok
ชช 
(
ชช 
response
ชช 
)
ชช 
;
ชช  
}
ซซ 	
catch
ฌฌ 
(
ฌฌ 
	Exception
ฌฌ 
e
ฌฌ 
)
ฌฌ 
{
ญญ 	
return
ฎฎ 
NotFound
ฎฎ 
(
ฎฎ 
e
ฎฎ 
.
ฎฎ 
Message
ฎฎ %
)
ฎฎ% &
;
ฎฎ& '
}
ฏฏ 	
}
ฐฐ 
[
นน 
HttpGet
นน 
(
นน 
$str
นน $
)
นน$ %
]
นน% &
public
บบ 

async
บบ 
Task
บบ 
<
บบ 
IActionResult
บบ #
>
บบ# $+
GetProductItemPropertiesAsync
บบ% B
(
บบB C
int
บบC F
id
บบG I
)
บบI J
{
ปป 
var
ฝฝ 

properties
ฝฝ 
=
ฝฝ 
new
ฝฝ 

Dictionary
ฝฝ '
<
ฝฝ' (
string
ฝฝ( .
,
ฝฝ. /
string
ฝฝ0 6
>
ฝฝ6 7
{
พพ 	
{
ฟฟ 
$str
ฟฟ 
,
ฟฟ 
$str
ฟฟ  
}
ฟฟ! "
,
ฟฟ" #
{
ภภ 
$str
ภภ 
,
ภภ 
$str
ภภ 
}
ภภ 
}
มม 	
;
มม	 

var
รร 
catalogItem
รร 
=
รร 
await
รร !
_productItemService
รร  3
.
รร3 4
GetByIdAsync
รร4 @
(
รร@ A
id
รรA C
)
รรC D
;
รรD E
if
ลล 

(
ลล 
catalogItem
ลล 
==
ลล 
null
ลล 
)
ลล  
{
ฦฦ 	
return
วว 
NotFound
วว 
(
วว 
)
วว 
;
วว 
}
ศศ 	
var
สส 
response
สส 
=
สส 
new
สส 
HalResponse
สส &
{
หห 	
Links
ฬฬ 
=
ฬฬ 
new
ฬฬ 
List
ฬฬ 
<
ฬฬ 
Link
ฬฬ !
>
ฬฬ! "
{
ออ 	
new
ฮฮ 
(
ฮฮ 
)
ฮฮ 
{
ฮฮ 
Rel
ฮฮ 
=
ฮฮ 
$str
ฮฮ  
,
ฮฮ  !
Href
ฮฮ" &
=
ฮฮ' (
$"
ฮฮ) +
$str
ฮฮ+ :
{
ฮฮ: ;
id
ฮฮ; =
}
ฮฮ= >
$str
ฮฮ> I
"
ฮฮI J
}
ฮฮK L
}
ฯฯ 	
,
ฯฯ	 

Data
ะะ 
=
ะะ 
new
ะะ 
{
ัั 
CatalogItemId
าา 
=
าา 
catalogItem
าา  +
.
าา+ ,
Id
าา, .
,
าา. /

Properties
ำำ 
=
ำำ 

properties
ำำ '
}
ิิ 
}
ีี 	
;
ีี	 

return
ืื 
Ok
ืื 
(
ืื 
response
ืื 
)
ืื 
;
ืื 
}
ุุ 
[
แแ 
HttpPut
แแ 
(
แแ 
$str
แแ 
)
แแ 
]
แแ 
public
โโ 

async
โโ 
Task
โโ 
<
โโ 
IActionResult
โโ #
>
โโ# $
UpdateProductItem
โโ% 6
(
โโ6 7
ProductItem
โโ7 B
item
โโC G
)
โโG H
{
ใใ 
if
ไไ 

(
ไไ 
item
ไไ 
==
ไไ 
null
ไไ 
)
ไไ 
{
ๅๅ 	
return
ๆๆ 

BadRequest
ๆๆ 
(
ๆๆ 
)
ๆๆ 
;
ๆๆ  
}
็็ 	
try
้้ 
{
๊๊ 	
await
๋๋ !
_productItemService
๋๋ %
.
๋๋% &
UpdateAsync
๋๋& 1
(
๋๋1 2
item
๋๋2 6
)
๋๋6 7
;
๋๋7 8
return
์์ 
Ok
์์ 
(
์์ 
$"
์์ 
$str
์์ -
{
์์- .
item
์์. 2
.
์์2 3
Id
์์3 5
}
์์5 6
$str
์์6 >
"
์์> ?
)
์์? @
;
์์@ A
}
ํํ 	
catch
๎๎ 
(
๎๎ 
	Exception
๎๎ 
e
๎๎ 
)
๎๎ 
{
๏๏ 	
return
๐๐ 
NotFound
๐๐ 
(
๐๐ 
e
๐๐ 
.
๐๐ 
Message
๐๐ %
)
๐๐% &
;
๐๐& '
}
๑๑ 	
}
๒๒ 
[
๛๛ 

HttpDelete
๛๛ 
(
๛๛ 
$str
๛๛ 
)
๛๛ 
]
๛๛ 
public
 

async
 
Task
 
<
 
IActionResult
 #
>
# $
DeleteProductItem
% 6
(
6 7
int
7 :
id
; =
)
= >
{
 
if
 

(
 
id
 
==
 
$num
 
)
 
{
 	
return
 

BadRequest
 
(
 
)
 
;
  
}
 	
try
 
{
 	
await
 !
_productItemService
 %
.
% &
DeleteAsync
& 1
(
1 2
id
2 4
)
4 5
;
5 6
return
 
Ok
 
(
 
$"
 
$str
 -
{
- .
id
. 0
}
0 1
$str
1 9
"
9 :
)
: ;
;
; <
}
 	
catch
 
(
 
	Exception
 
e
 
)
 
{
 	
return
 
NotFound
 
(
 
e
 
.
 
Message
 %
)
% &
;
& '
}
 	
}
 
} ั
H/Users/pavel/project/NetMentoring/CatalogWebApi/GraphQL/CatalogSchema.cs
	namespace 	
CatalogWebApi
 
. 
GraphQL 
;  
public

 
class

 
CatalogSchema

 
:

 
Schema

 #
{ 
public 

CatalogSchema 
( 
CatalogQuery %
query& +
,+ ,
CatalogMutation- <
mutation= E
)E F
:G H
baseI M
(M N
)N O
{ 
Query 
= 
query 
; 
Mutation 
= 
mutation 
; 
} 
} ุ<
T/Users/pavel/project/NetMentoring/CatalogWebApi/GraphQL/Mutations/CatalogMutation.cs
	namespace 	
CatalogWebApi
 
. 
GraphQL 
.  
	Mutations  )
;) *
public 
class 
CatalogMutation 
: 
ObjectGraphType .
{ 
public 

CatalogMutation 
( 
IServiceProvider +
serviceProvider, ;
); <
{ 
var 
categoryService 
= 
serviceProvider -
.- .
GetRequiredService. @
<@ A
ICategoryServiceA Q
>Q R
(R S
)S T
;T U
var 
productItemService 
=  
serviceProvider! 0
.0 1
GetRequiredService1 C
<C D
IProductItemServiceD W
>W X
(X Y
)Y Z
;Z [
Field 
< 
CategoryType 
> 
( 
$str )
)) *
. 	
	Arguments	 
( 
new 
QueryArguments 
(  
new 
QueryArgument !
<! "
NonNullGraphType" 2
<2 3
CategoryInputType3 D
>D E
>E F
{G H
NameI M
=N O
$strP Z
}[ \
) 	
)	 

. 	
ResolveAsync	 
( 
async 
context #
=>$ &
{ 	
var 
category 
= 
context "
." #
GetArgument# .
<. /
Category/ 7
>7 8
(8 9
$str9 C
)C D
;D E
await 
categoryService !
.! "
AddAsync" *
(* +
category+ 3
)3 4
;4 5
return 
category 
; 
}   	
)"" 	
;""	 

Field$$ 
<$$ 
ProductItemType$$ 
>$$ 
($$ 
$str$$ (
)$$( )
.%% 	
	Arguments%%	 
(%% 
new%% 
QueryArguments%% %
(%%% &
new&& 
QueryArgument&& !
<&&! "
NonNullGraphType&&" 2
<&&2 3 
ProductItemInputType&&3 G
>&&G H
>&&H I
{&&J K
Name&&L P
=&&Q R
$str&&S `
}&&a b
)'' 
)'' 
.(( 	
ResolveAsync((	 
((( 
async(( 
context(( #
=>(($ &
{)) 	
var** 
productItem** 
=** 
context** %
.**% &
GetArgument**& 1
<**1 2
ProductItem**2 =
>**= >
(**> ?
$str**? L
)**L M
;**M N
await++ 
productItemService++ $
.++$ %
AddAsync++% -
(++- .
productItem++. 9
)++9 :
;++: ;
return,, 
productItem,, 
;,, 
}-- 	
).. 	
;..	 

Field00 
<00 
CategoryType00 
>00 
(00 
$str00 ,
)00, -
.11 
	Arguments11 
(11 
new22 
QueryArguments22 
(22  
new33 
QueryArgument33 !
<33! "
NonNullGraphType33" 2
<332 3
CategoryInputType333 D
>33D E
>33E F
{33G H
Name33I M
=33N O
$str33P Z
}33[ \
)44 	
)44	 

.55 	
ResolveAsync55	 
(55 
async55 
context55 #
=>55$ &
{66 	
var77 
category77 
=77 
context77 "
.77" #
GetArgument77# .
<77. /
Category77/ 7
>777 8
(778 9
$str779 C
)77C D
;77D E
await99 
categoryService99 !
.99! "
UpdateAsync99" -
(99- .
category99. 6
)996 7
;997 8
return:: 
category:: 
;:: 
};; 	
);;	 

;;;
 
Field== 
<== 
ProductItemType== 
>== 
(== 
$str== +
)==+ ,
.>> 	
	Arguments>>	 
(>> 
new>> 
QueryArguments>> %
(>>% &
new?? 
QueryArgument?? !
<??! "
NonNullGraphType??" 2
<??2 3 
ProductItemInputType??3 G
>??G H
>??H I
{??J K
Name??L P
=??Q R
$str??S `
}??a b
)@@ 
)@@ 
.AA 	
ResolveAsyncAA	 
(AA 
asyncAA 
contextAA #
=>AA$ &
{BB 	
varCC 
productItemCC 
=CC 
contextCC %
.CC% &
GetArgumentCC& 1
<CC1 2
ProductItemCC2 =
>CC= >
(CC> ?
$strCC? L
)CCL M
;CCM N
awaitDD 
productItemServiceDD $
.DD$ %
UpdateAsyncDD% 0
(DD0 1
productItemDD1 <
)DD< =
;DD= >
returnEE 
productItemEE 
;EE 
}FF 	
)FF	 

;FF
 
FieldHH 
<HH 
BooleanGraphTypeHH 
>HH 
(HH  
$strHH  ,
)HH, -
.II 	
	ArgumentsII	 
(II 
newII 
QueryArgumentsII %
(II% &
newJJ 
QueryArgumentJJ !
<JJ! "
NonNullGraphTypeJJ" 2
<JJ2 3
IntGraphTypeJJ3 ?
>JJ? @
>JJ@ A
{JJB C
NameJJD H
=JJI J
$strJJK O
}JJP Q
)KK 
)KK 
.LL 	
ResolveAsyncLL	 
(LL 
asyncLL 
contextLL #
=>LL$ &
{MM 	
varNN 
idNN 
=NN 
contextNN 
.NN 
GetArgumentNN (
<NN( )
intNN) ,
>NN, -
(NN- .
$strNN. 2
)NN2 3
;NN3 4
awaitOO 
productItemServiceOO $
.OO$ %
DeleteAsyncOO% 0
(OO0 1
idOO1 3
)OO3 4
;OO4 5
returnPP 
truePP 
;PP 
}QQ 	
)QQ	 

;QQ
 
FieldSS 
<SS 
BooleanGraphTypeSS 
>SS 
(SS  
$strSS  0
)SS0 1
.TT 	
	ArgumentsTT	 
(TT 
newTT 
QueryArgumentsTT %
(TT% &
newUU 
QueryArgumentUU !
<UU! "
NonNullGraphTypeUU" 2
<UU2 3
IntGraphTypeUU3 ?
>UU? @
>UU@ A
{UUB C
NameUUD H
=UUI J
$strUUK O
}UUP Q
)VV 
)VV 
.WW 	
ResolveAsyncWW	 
(WW 
asyncWW 
contextWW #
=>WW$ &
{XX 	
varYY 
idYY 
=YY 
contextYY 
.YY 
GetArgumentYY (
<YY( )
intYY) ,
>YY, -
(YY- .
$strYY. 2
)YY2 3
;YY3 4
awaitZZ 
categoryServiceZZ !
.ZZ! "
DeleteAsyncZZ" -
(ZZ- .
idZZ. 0
)ZZ0 1
;ZZ1 2
return[[ 
true[[ 
;[[ 
}\\ 	
)\\	 

;\\
 
}]] 
}^^ ่
O/Users/pavel/project/NetMentoring/CatalogWebApi/GraphQL/Queries/CatalogQuery.cs
	namespace 	
CatalogWebApi
 
. 
GraphQL 
.  
Queries  '
;' (
public 
class 
CatalogQuery 
: 
ObjectGraphType +
{ 
public 

CatalogQuery 
( 
IServiceProvider (
serviceProvider) 8
)8 9
{ 
var 
categoryService 
= 
serviceProvider -
.- .
GetRequiredService. @
<@ A
ICategoryServiceA Q
>Q R
(R S
)S T
;T U
var 
productItemService 
=  
serviceProvider! 0
.0 1
GetRequiredService1 C
<C D
IProductItemServiceD W
>W X
(X Y
)Y Z
;Z [
Field 
< 
ListGraphType 
< 
CategoryType (
>( )
>) *
(* +
$str+ 7
)7 8
. 	
Description	 
( 
$str 5
)5 6
. 	
ResolveAsync	 
( 
async 
context #
=>$ &
{ 
var 

categories 
=  
await! &
categoryService' 6
.6 7
GetAllAsync7 B
(B C
)C D
;D E
return 

categories !
;! "
} 
) 
; 
Field 
< 
ListGraphType 
< 
ProductItemType +
>+ ,
>, -
(- .
$str. 5
)5 6
.   	
Description  	 
(   
$str   0
)  0 1
.!! 	
	Arguments!!	 
(!! 
new"" 
QueryArguments"" 
("" 
new## 
QueryArgument## !
<##! "
NonNullGraphType##" 2
<##2 3
IntGraphType##3 ?
>##? @
>##@ A
{##B C
Name##D H
=##I J
$str##K Q
}##R S
,##S T
new$$ 
QueryArgument$$ !
<$$! "
NonNullGraphType$$" 2
<$$2 3
IntGraphType$$3 ?
>$$? @
>$$@ A
{$$B C
Name$$D H
=$$I J
$str$$K U
}$$V W
)%% 
)&& 	
.'' 	
ResolveAsync''	 
('' 
async'' 
context'' #
=>''$ &
{(( 
var)) 
page)) 
=)) 
context)) "
.))" #
GetArgument))# .
<)). /
int))/ 2
>))2 3
())3 4
$str))4 :
))): ;
;)); <
var** 
pageSize** 
=** 
context** &
.**& '
GetArgument**' 2
<**2 3
int**3 6
>**6 7
(**7 8
$str**8 B
)**B C
;**C D
return++ 
await++ 
productItemService++ /
.++/ 0
GetAllAsync++0 ;
(++; <
page++< @
,++@ A
pageSize++B J
)++J K
;++K L
},, 
)-- 	
;--	 

}.. 
}// ง
R/Users/pavel/project/NetMentoring/CatalogWebApi/GraphQL/Types/CategoryInputType.cs
	namespace 	
CatalogWebApi
 
. 
GraphQL 
.  
Types  %
{ 
public		 

class		 
CategoryInputType		 "
:		# $ 
InputObjectGraphType		% 9
<		9 :
Category		: B
>		B C
{

 
public 
CategoryInputType  
(  !
)! "
{ 	
Name 
= 
$str "
;" #
Field 
< 
NonNullGraphType "
<" #
StringGraphType# 2
>2 3
>3 4
(4 5
$str5 ;
); <
;< =
} 	
} 
} ฯ
M/Users/pavel/project/NetMentoring/CatalogWebApi/GraphQL/Types/CategoryType.cs
	namespace 	
CatalogWebApi
 
. 
GraphQL 
.  
Types  %
{ 
public		 

class		 
CategoryType		 
:		 
ObjectGraphType		  /
<		/ 0
Category		0 8
>		8 9
{

 
public 
CategoryType 
( 
) 
{ 	
Field 
( 
x 
=> 
x 
. 
Id 
, 
type !
:! "
typeof# )
() *
IdGraphType* 5
)5 6
)6 7
.7 8
Description8 C
(C D
$strD ]
)] ^
;^ _
Field 
( 
x 
=> 
x 
. 
Name 
) 
. 
Description *
(* +
$str+ F
)F G
;G H
} 	
} 
} ี
U/Users/pavel/project/NetMentoring/CatalogWebApi/GraphQL/Types/ProductItemInputType.cs
	namespace 	
CatalogWebApi
 
. 
GraphQL 
.  
Types  %
{ 
public		 

class		  
ProductItemInputType		 %
:		& ' 
InputObjectGraphType		( <
<		< =
ProductItem		= H
>		H I
{

 
public  
ProductItemInputType #
(# $
)$ %
{ 	
Name 
= 
$str %
;% &
Field 
< 
NonNullGraphType "
<" #
StringGraphType# 2
>2 3
>3 4
(4 5
$str5 ;
); <
;< =
Field 
< 
NonNullGraphType "
<" #
StringGraphType# 2
>2 3
>3 4
(4 5
$str5 B
)B C
;C D
Field 
< 
NonNullGraphType "
<" #
DecimalGraphType# 3
>3 4
>4 5
(5 6
$str6 =
)= >
;> ?
Field 
< 
NonNullGraphType "
<" #
StringGraphType# 2
>2 3
>3 4
(4 5
$str5 ?
)? @
;@ A
Field 
< 
NonNullGraphType "
<" #
IntGraphType# /
>/ 0
>0 1
(1 2
$str2 >
)> ?
;? @
} 	
} 
} 
P/Users/pavel/project/NetMentoring/CatalogWebApi/GraphQL/Types/ProductItemType.cs
	namespace 	
CatalogWebApi
 
. 
GraphQL 
.  
Types  %
{ 
public		 

class		 
ProductItemType		  
:		! "
ObjectGraphType		# 2
<		2 3
ProductItem		3 >
>		> ?
{

 
public 
ProductItemType 
( 
)  
{ 	
Field 
( 
x 
=> 
x 
. 
Id 
, 
type !
:! "
typeof# )
() *
IdGraphType* 5
)5 6
)6 7
.7 8
Description8 C
(C D
$strD a
)a b
;b c
Field 
( 
x 
=> 
x 
. 
Name 
) 
. 
Description *
(* +
$str+ J
)J K
;K L
Field 
( 
x 
=> 
x 
. 
Description $
)$ %
.% &
Description& 1
(1 2
$str2 X
)X Y
;Y Z
Field 
( 
x 
=> 
x 
. 
Price 
) 
.  
Description  +
(+ ,
$str, L
)L M
;M N
Field 
( 
x 
=> 
x 
. 
ImageUrl !
)! "
." #
Description# .
(. /
$str/ [
)[ \
;\ ]
} 	
} 
} 
G/Users/pavel/project/NetMentoring/CatalogWebApi/HalModel/HalResponse.cs
	namespace 	
CatalogWebApi
 
. 
HalModel  
;  !
public 
class 
HalResponse 
{ 
public 
List	 
< 
Link 
> 
? 
Links 
{ 
get  
;  !
set" %
;% &
}' (
public 

Dictionary	 
< 
string 
, 
object "
>" #
?# $
Embedded% -
{. /
get0 3
;3 4
set5 8
;8 9
}: ;
public 
object	 
? 
Data 
{ 
get 
; 
set  
;  !
}" #
} ํ
@/Users/pavel/project/NetMentoring/CatalogWebApi/HalModel/Link.cs
	namespace 	
CatalogWebApi
 
. 
HalModel  
;  !
public 
class 
Link 
{ 
public 
string	 
? 
Rel 
{ 
get 
; 
set 
;  
}! "
public 
string	 
? 
Href 
{ 
get 
; 
set  
;  !
}" #
public 
string	 
? 
Method 
{ 
get 
; 
set "
;" #
}$ %
} ๊<
:/Users/pavel/project/NetMentoring/CatalogWebApi/Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Services 
. 
AddDbContext 
< 
CatalogDbContext .
>. /
(/ 0
options0 7
=>8 :
{; <
options= D
.D E
UseInMemoryDatabaseE X
(X Y
$strY b
)b c
;c d
}e f
)f g
;g h
builder 
. 
Services 
. +
AddApplicationInsightsTelemetry 0
(0 1
)1 2
;2 3
builder 
. 
Services 
. 
AddAuthentication "
(" #
JwtBearerDefaults# 4
.4 5 
AuthenticationScheme5 I
)I J
. 
AddJwtBearer 
( 

AuthConfig 
. 
ConfigureJwtBearer /
(/ 0
builder0 7
)7 8
)8 9
;9 :
builder 
. 
Services 
. 
AddAuthorization !
(! "

AuthConfig" ,
., -"
ConfigureAuthorization- C
(C D
builderD K
)K L
)L M
;M N
builder 
. 
Services 
. 
AddSingleton 
< !
IAuthorizationHandler 3
,3 4
HasScopeHandler5 D
>D E
(E F
)F G
;G H
builder 
. 
Services 
. 
AddControllers 
(  
)  !
;! "
builder 
. 
Services 
. 
AddApiVersioning !
(! "
SwaggerConfig" /
./ 0%
SetupApiVersioningOptions0 I
)I J
.J K
AddApiExplorerK Y
(Y Z
SwaggerConfigZ g
.g h#
SetupApiExplorerOptionsh 
)	 
;
 
builder 
. 
Services 
. 
AddTransient 
< 
IConfigureOptions /
</ 0
SwaggerGenOptions0 A
>A B
,B C#
ConfigureSwaggerOptionsD [
>[ \
(\ ]
)] ^
;^ _
builder 
. 
Services 
. 
AddSwaggerGen 
( 
SwaggerConfig ,
., -"
SetupSwaggerGenOptions- C
)C D
;D E
builder   
.   
Services   
.   
	AddScoped   
<   
ICategoryRepository   .
,  . /
CategoryRepository  0 B
>  B C
(  C D
)  D E
;  E F
builder!! 
.!! 
Services!! 
.!! 
	AddScoped!! 
<!! "
IProductItemRepository!! 1
,!!1 2!
ProductItemRepository!!3 H
>!!H I
(!!I J
)!!J K
;!!K L
builder"" 
."" 
Services"" 
."" 
AddSingleton"" 
<"" 
IEventBusRabbitMq"" /
>""/ 0
(""0 1
_""1 2
=>""3 5
EventBusConfig""6 D
.""D E%
ConfigureEventBusRabbitMq""E ^
(""^ _
builder""_ f
)""f g
)""g h
;""h i
builder## 
.## 
Services## 
.## 
	AddScoped## 
<## 
ICategoryService## +
,##+ ,
CategoryService##- <
>##< =
(##= >
)##> ?
;##? @
builder$$ 
.$$ 
Services$$ 
.$$ 
	AddScoped$$ 
<$$ 
IProductItemService$$ .
,$$. /
ProductItemService$$0 B
>$$B C
($$C D
)$$D E
;$$E F
builder%% 
.%% 
Services%% 
.%% 
AddHostedService%% !
<%%! "'
CustomInitializationService%%" =
>%%= >
(%%> ?
)%%? @
;%%@ A
builder&& 
.&& 
Services&& 
.&& 
AddSingleton&& 
<&& 
CatalogQuery&& *
>&&* +
(&&+ ,
)&&, -
;&&- .
builder'' 
.'' 
Services'' 
.'' 
AddSingleton'' 
<'' 
CatalogMutation'' -
>''- .
(''. /
)''/ 0
;''0 1
builder(( 
.(( 
Services(( 
.(( 
	AddScoped(( 
<(( 
CatalogSchema(( (
>((( )
((() *
)((* +
;((+ ,
builder)) 
.)) 
Logging)) 
.)) "
AddApplicationInsights)) &
())& '+
configureTelemetryConfiguration** '
:**' (
(**) *
config*** 0
)**0 1
=>**2 4
config++ 
.++ 
ConnectionString++ #
=++$ %
builder++& -
.++- .
Configuration++. ;
[++; <
$str++< b
]++b c
,++c d5
)configureApplicationInsightsLoggerOptions,, 5
:,,5 6
(,,7 8
options,,8 ?
),,? @
=>,,A C
{,,D E
},,F G
)-- 
;-- 
builder// 
.// 
Logging// 
.// 
	AddFilter// 
<// -
!ApplicationInsightsLoggerProvider// ;
>//; <
(//< =
$str//= Q
,//Q R
LogLevel//S [
.//[ \
Trace//\ a
)//a b
;//b c
builder33 
.33 
Services33 
.33 

AddGraphQL33 
(33 
b33 
=>33  
b33! "
.44 
	AddSchema44 

<44
 
CatalogSchema44 
>44 
(44 
)44 
.55 
AddSystemTextJson55 
(55 
)55 
.66 
AddGraphTypes66 
(66 
typeof66 
(66 
CatalogSchema66 #
)66# $
.66$ %
Assembly66% -
)66- .
)66. /
;66/ 0
var88 
app88 
=88 	
builder88
 
.88 
Build88 
(88 
)88 
;88 
if;; 
(;; 
app;; 
.;; 
Environment;; 
.;; 
IsDevelopment;; !
(;;! "
);;" #
);;# $
{<< 
app== 
.== 

UseSwagger== 
(== 
)== 
;== 
app>> 
.>> 
UseSwaggerUI>> 
(>> 
options>> 
=>>> 
SwaggerConfig>>  -
.>>- .!
SetupSwaggerUiOptions>>. C
(>>C D
options>>D K
,>>K L
app>>M P
)>>P Q
)>>Q R
;>>R S
}?? 
appBB 
.BB 
UseGraphQLGraphiQLBB 
(BB 
$strBB $
)BB$ %
;BB% &
appDD 
.DD 
UseAuthenticationDD 
(DD 
)DD 
;DD 
appEE 
.EE 
UseAuthorizationEE 
(EE 
)EE 
;EE 
appGG 
.GG 
MapControllersGG 
(GG 
)GG 
;GG 
appII 
.II 
RunII 
(II 
)II 	
;II	 

V/Users/pavel/project/NetMentoring/CatalogWebApi/Service/CustomInitializationService.cs
	namespace 	
CatalogWebApi
 
. 
Service 
;  
public		 
class		 '
CustomInitializationService		 (
:		) *
IHostedService		+ 9
{

 
private 	
readonly
  
IServiceScopeFactory '
_scopeFactory( 5
;5 6
public '
CustomInitializationService	 $
($ % 
IServiceScopeFactory% 9
scopeFactory: F
)F G
{ 
_scopeFactory 
= 
scopeFactory  
;  !
} 
public 
async	 
Task 

StartAsync 
( 
CancellationToken 0
cancellationToken1 B
)B C
{ 
using 	
var
 
scope 
= 
_scopeFactory #
.# $
CreateScope$ /
(/ 0
)0 1
;1 2
await 	
using
 
var 
	dbContext 
= 
scope  %
.% &
ServiceProvider& 5
.5 6

GetService6 @
<@ A
CatalogDbContextA Q
>Q R
(R S
)S T
;T U
var 

categories 
= 
new 
List 
< 
Category &
>& '
{ 
new 	
Category
 
{ 
Id 
= 
$num 
, 
Name !
=" #
$str$ /
}0 1
,1 2
new   	
Category  
 
{   
Id   
=   
$num   
,   
Name   !
=  " #
$str  $ /
}  0 1
,  1 2
new!! 	
Category!!
 
{!! 
Id!! 
=!! 
$num!! 
,!! 
Name!! !
=!!" #
$str!!$ /
}!!0 1
}"" 
;"" 
await## 	
	dbContext##
 
?## 
.## 

Categories## 
.##  
AddRangeAsync##  -
(##- .

categories##. 8
)##8 9
;##9 :
await$$ 	
	dbContext$$
 
.$$ 
SaveChangesAsync$$ $
($$$ %
cancellationToken$$% 6
)$$6 7
;$$7 8
}%% 
public)) 
Task))	 
	StopAsync)) 
()) 
CancellationToken)) )
cancellationToken))* ;
))); <
{** 
return++ 

Task++ 
.++ 
CompletedTask++ 
;++ 
},, 
}-- 